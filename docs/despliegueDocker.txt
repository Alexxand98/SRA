# Despliegue de SQL Server con Docker para el proyecto SRA (Sistema de Reservas del Aula AtecA)

Este documento describe los pasos necesarios para levantar un contenedor Docker con SQL Server 2022, crear un usuario espec칤fico con los permisos adecuados para la API, y preparar la base de datos para que la API pueda operar correctamente. Es una parte fundamental del backend del sistema.

---

游댲 1. Crear el contenedor de SQL Server

docker run -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=wnD/LbJq?X39t,}-628%)' -e "MSSQL_PID=Developer" \
  -p 1433:1433 \
  --name SQL_Server_DI \
  -v SQL_Server_Volume:/var/opt/mssql \
  -d mcr.microsoft.com/mssql/server:2022-latest

游늷 Explicaci칩n:
- `-e 'ACCEPT_EULA=Y'`: Acepta la licencia de uso de SQL Server.
- `-e 'MSSQL_SA_PASSWORD=...'`: Establece la contrase침a del usuario `sa` (administrador).
- `-e 'MSSQL_PID=Developer'`: Usa la edici칩n gratuita para desarrollo.
- `-p 1433:1433`: Expone el puerto est치ndar de SQL Server.
- `--name SQL_Server_DI`: Nombra el contenedor como `SQL_Server_DI`.
- `-v SQL_Server_Volume:/var/opt/mssql`: Persistencia de datos en un volumen de Docker.
- `-d mcr.microsoft.com/mssql/server:2022-latest`: Imagen oficial de SQL Server 2022.

九덢잺 Esto proporciona una base de datos persistente y accesible localmente para desarrollo y pruebas de la API del proyecto SRA.

---

游댲 2. Crear un login y usuario para la API

-- Crear login en el servidor
CREATE LOGIN AppUserLogin WITH PASSWORD = 'e.d_fwm2()~37hz?+LBT4V';

-- Crear usuario a nivel de base de datos
CREATE USER AppUser FOR LOGIN AppUserLogin;

九덢잺 As칤 evitamos usar el usuario `sa`, lo que mejora la seguridad. La API se conectar치 con `AppUser`, que tendr치 solo los permisos necesarios.

---

游댲 3. Crear base de datos y asociar usuario

CREATE DATABASE Basic;
USE Basic;

CREATE USER AppUser FOR LOGIN AppUserLogin;

九덢잺 Creamos la base de datos `Basic`, que usar치 la API como origen de datos. Asociamos de nuevo el usuario `AppUser` en este contexto.

---

游댲 4. Otorgar permisos adecuados al usuario

-- Permisos CRUD
GRANT SELECT, INSERT, UPDATE, DELETE ON SCHEMA::dbo TO AppUser;

-- O bien usando roles est치ndar:
EXEC sp_addrolemember 'db_datareader', 'AppUser';
EXEC sp_addrolemember 'db_datawriter', 'AppUser';

九덢잺 Se otorgan los permisos para que `AppUser` pueda leer y modificar los datos, pero sin control total como `sa`.

---

游댲 5. Permisos adicionales para migraciones y ejecuci칩n

-- Permisos para EF Core
GRANT ALTER ON SCHEMA::dbo TO AppUser;
GRANT REFERENCES ON SCHEMA::dbo TO AppUser;
GRANT CREATE TABLE TO AppUser;
GRANT CREATE PROCEDURE TO AppUser;
GRANT CREATE VIEW TO AppUser;
GRANT EXECUTE ON SCHEMA::dbo TO AppUser;

九덢잺 Estos permisos permiten que Entity Framework Core pueda crear, modificar y ejecutar estructuras necesarias durante el desarrollo y despliegue del sistema (tablas, procedimientos, vistas...).

---

游늷 쯇or qu칠 usamos este sistema?

El proyecto **SRA** requiere una base de datos robusta y segura, con acceso controlado desde la API. Esta configuraci칩n:

- Separa el acceso del administrador (`sa`) del acceso de la aplicaci칩n (`AppUser`).
- Permite que EF Core cree la estructura de la base de datos mediante `Code First`.
- Proporciona un entorno f치cilmente replicable y portable usando Docker.
- Cumple con buenas pr치cticas de seguridad al no usar el superusuario en producci칩n/desarrollo.

Este despliegue sirve como base para conectar correctamente la API `.NET` del sistema de reservas del Aula AtecA, asegurando que pueda autenticar, gestionar reservas, franjas horarias y d칤as no lectivos de forma segura y eficiente.
